# JavaScript テトリスサンプル

いつでも空で書けるようになっておきたい（願望）

## 作り方参考リンク

- https://github.com/DQNEO/CppTetris

---

## 付録

個人的な開発メモなど

### 回転処理について

例として T 字型ミノを 3x3 で図式化
座標は`@`のところが`[0, 0]`とする

```
_ □ _
□ @ ■
_ _ _
```

塗り潰し四角（■）に注目
これを `@` を中心に９０度反時計回りすると

```
_ ■ _
□ @ _
_ □ _

```

■ の座標は
`[1, 0] => [0, -1]`

回転前座標を nx,ny、変化後を dx, dy とすると、この位置の変化は以下の式で表すことができる

```math
dx = nx * cos(90) + ny * sin(90)
dy = -nx * sin(90) + ny * cos(90)
```

これは[回転行列を掛けることで座標変換している](https://math-fun.net/20201211/7086/)
（Y 軸方向の正負が逆転しているため、それを補正する必要があることに注意）

ところで cos90 = 0, sin90 = 1 はそれぞれ定数なので
以下のように計算を簡略化できる

```math
dx = ny
dy = -nx
```

以上の計算を回転ごとに行っていけば表現できる

#### [補足]Y 軸方向による回転方向の違いについて

一般的にプログラミングでは
X 軸は画面 → 方向が正、
Y 軸は画面 ↓ 方向が正となっていることが多い

しかし前述の図では Y 軸は ↑ が正となる
したがって「＋９０回転する」は時計回りになる

#### ゲーム的に取りうる形態は限られる

90° 回転で、どのミノも４回転で当然元の状態に戻る
しかしテトリス棒など通常２形態しかとらないミノもある

```
_ _ _ _ _
_ □ x □ □
_ _ _ _ _
_ _ _ _ _
```

こうだったり

```
_ □ _ _
_ x _ _
_ □ _ _
_ □ _ _
```

こうなったりするが

```
_ _ _ _ _
□ □ x □ _
_ _ _ _ _
_ _ _ _ _
```

こうはならない

したがって、必要に応じて回転数を制限する必要がある

```js
let rotatedCount = current.rotatedCount % rotatable;
```
